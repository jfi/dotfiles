#!/bin/zsh
set -euo pipefail

# Ensure mise is in PATH (may have just been installed)
export PATH="${HOME}/.local/bin:${PATH}"

# Install latest stable Ruby via mise
echo "Installing latest stable Ruby via mise..."
LATEST_RUBY=$(mise ls-remote ruby | grep -E '^[0-9]+\.[0-9]+\.[0-9]+$' | tail -1)
mise use --global ruby@$LATEST_RUBY
echo "Installed Ruby $LATEST_RUBY"

# Update RubyGems and install latest Bundler
echo "Updating RubyGems..."
gem update --system --no-document
echo "Installing latest Bundler..."
gem install bundler --no-document

echo
echo "3-install-ruby complete."
echo
echo "Ruby $(ruby --version)"
echo "RubyGems $(gem --version)"
echo "Bundler $(bundle --version)"
echo

# Pause for confirmation before proceeding
if [ -r /dev/tty ]; then
  printf "Press Enter to continue..." >&2
  read -r </dev/tty
fi
